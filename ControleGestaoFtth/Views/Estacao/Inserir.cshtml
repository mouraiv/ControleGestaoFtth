@model Estacoe

<div id="formInsert" class="d-flex flex-row justify-content-center">
    <div style="width:600px;">
        <!-- Formulário para edição -->
        <form asp-controller="Estacao" asp-action="Inserir" method="post" class="needs-validation" novalidate>
            <div class="bg-primary text-center text-white p-1" style="font-size:0.8rem; font-weight:600;"><a>-- INSERIR --</a></div>
            <div id="formEditar" name="estacao" class="row">
                <div>
                    <!-- Alert para tratamento de exceções -->
                    @if (TempData["Sucesso"] != null)
                    {
                        <div id="alertForm" class="alert alert-success" role="alert">
                            <button type="button" class="close-alert text-success" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <a>@TempData["Sucesso"]</a>
                        </div>
                    }
                    @if (TempData["Falha"] != null)
                    {
                        <div id="alertForm" class="alert alert-danger" role="alert">
                            <button type="button" class="close-alert text-danger" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <a>@TempData["Falha"]</a>
                        </div>
                    }
                    <!-- End  Alert-->
                </div>
                <div class="d-flex">
                    <div class="form-group col">
                        <label>Estado:</label>
                        @Html.DropDownListFor(model => model.EstadosId,new SelectList(ViewBag.selectEstado,"Id","Nome"), "--Selecionar--",new { @id="dropEstadoIE", @class="custom-select", required = ""})
                        <div class="invalid-feedback">Campo Obrigatório.</div>
                    </div>
                    <div class="form-group col">
                        <label>Estação</label>
                        <select id="dropMunicipio" asp-for="NomeEstacao" class="custom-select" required>
                            <option selected>--Selecionar--</option>
                        </select>
                        <div class="invalid-feedback">Campo Obrigatório.</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Sigla:</label>
                    <input type="text" asp-for="Sigla" class="form-control" maxlength="50" required>
                    <div class="invalid-feedback">Campo Obrigatório.</div>
                </div>
                <div class="modal-footer p-0 m-0 mt-4">
                    <button type="submit" class="btn btn-primary mt-4 ms-2">Inserir</button>
                    <a role="button" asp-action="Index" asp-controller="Estacao" id="btnRoles" class="btn btn-secondary mt-4 me-2">Voltar</a>
                </div>
            </div>
        </form>
        <!-- End Formulário-->
    </div>
</div>

@section Scripts
    {
    <script>
        //FUNÇÃO REPONSÁVEL PELAS ACÕES JS/JQUERY DA VIEW INDEX CONSTRUTORA
        function EstacaoConfig() {

            //VARIAVEIS GLOBAIS LOCAL
            var estado = "";

            //BLOQUEAR DROPLIST
            $('#dropMunicipio').attr('disabled', true);

            //FUNÇÃO DE ATUALIZAÇÃO DISPLAY PARTIALVIEW
            const dropFilter = (url) => $.get(url,
                {}, function (resposta) {

                    if (resposta.municipios != undefined) {

                        //LIMPAR DROPLIST
                        $('#dropMunicipio').empty();

                        //RESETAR ESTAÇÃO
                        estacao = "";

                        //CARREGAR OPTION DEFAUT
                        $('#dropMunicipio').append($('<option/>', {
                            value: "",
                            text: "--Selecionar--"
                        }));

                        //LOAD DROPLIST ESTADO
                        $.each(
                            resposta.municipios,
                            function (index, item) {
                                $('#dropMunicipio').append($('<option/>', {
                                    value: item.nome,
                                    text: item.nome
                                }));
                            });
                    }

                    return false;
                });

            //FILTRO DROPDOWNLIST ESTACAO
            $('#dropEstadoIE').on('change', function () {   
                //CARREGAR VALOR DROPDOWN NA VARIAVEL
                estado = $('#dropEstadoIE option:selected').text();

                //CONDIÇÃO PARA BLOQUEIO DROPLIST ESTAÇÃO
                if (estado != "") {
                    //DESBLOQUEAR DROPLIST
                    $('#dropMunicipio').attr('disabled', false);
                } else {
                    //BLOQUEAR DROPLIST
                    $('#dropMunicipio').attr('disabled', true);
                }

                //CARREGAR DROPLIST ESTADO E ESTAÇÃO
                dropFilter('GetListMunicipios?estado=' + estado);

                return false;
            });
        } (EstacaoConfig());
        </script>
    }
