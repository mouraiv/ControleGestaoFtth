@using X.PagedList.Mvc.Core
@model X.PagedList.PagedList<Construtora>
@{

    ViewData["Title"] = "Construtora";

}

<div id="menuBarVertical">
    <a role="button" id="btnRoles" class="btn btn-primary btn-sm">Adicionar</a>
    <hr class="divisorMenu m-0 p-0 ms-3">
    <button type="button" class="btn btn-primary btn-sm ms-3">Modelo Base</button>
    <button type="button" class="btn btn-warning btn-sm ms-2">Importar Base</button>
</div>

<div class="container-filter">

     <div class="form-group" id="estacao">
         <label>Estação</label>
         @Html.DropDownList("selectEstacao",new SelectList(ViewBag.selectEstacao,"NomeEstacao","NomeEstacao"), "--Todos--",new { @id="dropEstacao", @class="custom-select"})
     </div>

    <div id="filterMenu">
    </div>

</div>

<div id="ftthLista">
    <div class="d-flex justify-content-center">
        <div class="spinner-border text-secondary m-5" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <a class="modal-title" id="exampleModalLabel">Ficha Técnica</a>
                </div>
                <div class="modal-body">

                    <!--Conteudo Display-->
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-secondary m-5" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" id="editarFtth" class="btn btn-primary">Editar</button>
                </div>
            </div>
        </div>
    </div>

    @section Scripts
        {
         <script>
            //FUNÇÃO REPONSÁVEL PELAS ACÕES JS/JQUERY DA VIEW INDEX CONSTRUTORA
            function ConstrutoraIndex() {

                //VARIAVEIS GLOBAIS LOCAL
                var estacao = "";
                var cdo = "";
                var cabo = "";
                var celula = "";
                var carregarId = "";

                //FUNÇÃO DE ATUALIZAÇÃO DISPLAY PARTIALVIEW TABELA FTTH BASE
                const ftth = (url) => $.get(url,
                    {}, function (resposta) {
                        $('#ftthLista').html($(resposta).filter('#tableUpdate').html());
                        return false;
                    });

                //DISPLAY ATUALIZAÇÃO DIV ELEMENT PANEL MENU FILTRO
                const panel = (url) => $.get(url,
                    {}, function (resposta) {
                        $('#filterMenu').html($(resposta).filter('#panelUpdate').html());
                        return false;
                    });

                //SPINNER LOADER
                const spinnerFtth = (display) => {
                    $(display).html(`
                        <div class= "d-flex justify-content-center">
                            <div class="spinner-border text-secondary m-5" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                        </div>
                    `   )
                }

                // ATUALIZAR DISPLAY PARTIAL VIEW
                ftth('Construtora/lista');

                //FILTRO DROPDOWNLIST DA TABELA FTTH BASE
                $('#dropEstacao').on('change', function () {
                    spinnerFtth('#ftthLista');
                    estacao = $('#dropEstacao').val();

                    panel('Construtora/lista?estacao=' + estacao);
                    ftth('Construtora/lista?estacao=' + estacao);
                    return false;
                });

                $('.container-filter').on('change', '#dropCdo', function () {
                    spinnerFtth('#ftthLista');
                    cdo = $('#dropCdo').val();

                    /* DESABILITAR DROPDOWNLIST "CABO" "CELULA" E RESETAR VARIAVEIS
                    GLOBAIS DOS MESMOS, CASO UM VALOR SEJA SET EM CDO */
                    if (cdo != "") {
                        cabo = "";
                        celula = "";
                        $('#dropCabo option[value = ""]').prop('selected', 'selected');
                        $('#dropCelula option[value = ""]').prop('selected', 'selected');
                        $('#dropCabo').attr('disabled', true);
                        $('#dropCelula').attr('disabled', true);
                    } else {
                        $('#dropCabo').attr('disabled', false);
                        $('#dropCelula').attr('disabled', false);
                    }
                    ftth('Construtora/Lista?estacao=' + estacao + '&cdo=' + cdo + '&cabo=' + cabo + '&celula=' + celula);
                    return false;
                });

                $('.container-filter').on('change', '#dropCabo', function () {
                    spinnerFtth('#ftthLista');
                    cabo = $('#dropCabo').val();
                    ftth('Construtora/Lista?estacao=' + estacao + '&cdo=' + cdo + '&cabo=' + cabo + '&celula=' + celula);
                    return false;
                });

                $('.container-filter').on('change', '#dropCelula', function () {
                    spinnerFtth('#ftthLista');
                    celula = $('#dropCelula').val();
                    ftth('Construtora/Lista?estacao=' + estacao + '&cdo=' + cdo + '&cabo=' + cabo + '&celula=' + celula);
                    return false;
                });

                //PAGINAÇÃO DA TABELA FTTH BASE
                $('#ftthLista, #paged').on('click', '.btnPaged', function () {
                    spinnerFtth('#ftthLista');
                    let urlFtth = $(this).find('a').attr('href');
                    ftth(urlFtth + '&estacao=' + estacao + '&cdo=' + cdo + '&cabo=' + cabo + '&celula=' + celula);
                    return false;
                });

                //PEGAR VALORES DA TABELA FTTH BASE PARA REQUISIÇÃO ATUALIZAR
                $('#ftthLista').on('click', '.tableFtth', function () {
                    carregarId = $(this).attr("data-id");

                    $.get('Construtora/Detalhe?id=' + carregarId,
                        {}, function (resposta) {
                            spinnerFtth('modal-body');
                            $('.modal-body').html($(resposta).find('#displayDetalheFtth').html());
                            return false;
                        });

                    $(this).find('#exampleModal').modal({
                        keyboard: true,
                        backdrop: "static",
                        show: false,

                    });
                });

                //CARREGAR VALORES A SEREM EDITADOS NA PAGINA EDITAR
                $('.modal-content').on('click', '#editarFtth', function () {
                    window.location.href = 'Construtora/Editar?id=' + carregarId;
                });

            } (ConstrutoraIndex());
        </script>
        }






